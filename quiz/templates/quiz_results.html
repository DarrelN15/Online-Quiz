{% extends 'base.html' %}
{% load static %}

{% block title %}Quiz Results{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Quiz Results</h2>
    
    <!-- Filtering and Search controls -->
    <form method="get" class="mb-4">
        <div class="row">
            <div class="col-md-2">
                <label for="user">User:</label>
                <input type="text" name="user" id="user" class="form-control" value="{{ user_filter }}">
            </div>
            <div class="col-md-2">
                <label for="quiz">Quiz:</label>
                <input type="text" name="quiz" id="quiz" class="form-control" value="{{ quiz_filter }}">
            </div>
            <div class="col-md-2">
                <label for="date_from">Date From:</label>
                <input type="date" name="date_from" id="date_from" class="form-control" value="{{ date_from }}">
            </div>
            <div class="col-md-2">
                <label for="date_to">Date To:</label>
                <input type="date" name="date_to" id="date_to" class="form-control" value="{{ date_to }}">
            </div>
            <div class="col-md-2">
                <label for="score_min">Min Score:</label>
                <input type="number" name="score_min" id="score_min" class="form-control" value="{{ score_min }}">
            </div>
            <div class="col-md-2">
                <label for="score_max">Max Score:</label>
                <input type="number" name="score_max" id="score_max" class="form-control" value="{{ score_max }}">
            </div>
        </div>
        
        <!-- Search bar -->
        <div class="row mt-3">
            <div class="col-md-4">
                <label for="search">Search:</label>
                <input type="text" name="search" id="search" class="form-control" value="{{ search_query }}">
            </div>
            <div class="col-md-2 align-self-end">
                <button type="submit" class="btn btn-primary">Search</button>
            </div>
        </div>
        
        <div class="row mt-3">
            <div class="col-md-2">
                <label for="sort_by">Sort by:</label>
                <select name="sort_by" id="sort_by" class="form-control">
                    <option value="date_taken" {% if sort_by == 'date_taken' %}selected{% endif %}>Date Taken</option>
                    <option value="percentage" {% if sort_by == 'percentage' %}selected{% endif %}>Percentage</option>
                    <option value="score" {% if sort_by == 'score' %}selected{% endif %}>Score</option>
                    <option value="user" {% if sort_by == 'user' %}selected{% endif %}>User</option>
                    <option value="quiz_title" {% if sort_by == 'quiz_title' %}selected{% endif %}>Quiz Title</option>
                </select>
            </div>
            <div class="col-md-2 align-self-end">
                <button type="submit" class="btn btn-primary">Filter</button>
            </div>
        </div>
    </form>
    
    <table class="table table-striped">
        <thead>
            <tr>
                <th>User</th>
                <th>Quiz</th>
                <th>Avg. Percentage</th>
                <th>Avg. Score</th>
                <th>Date Taken</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for item in page_obj %}
            <tr>
                <td>{{ item.attempt.user.username }}</td>
                <td>{{ item.attempt.quiz.title }}</td>
                <td>
                    <span class="badge {{ item.badge_color }}">{{ item.percentage_score|floatformat:2 }}%</span>
                </td>
                <td>{{ item.attempt.score }} / {{ item.total_questions }}</td>
                <td>{{ item.attempt.date_taken }}</td>
                <td><a href="{% url 'quiz_attempt_detail' item.attempt.id %}">View Details</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination controls -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1&sort_by={{ sort_by }}&user={{ user_filter }}&date_from={{ date_from }}&date_to={{ date_to }}&score_min={{ score_min }}&score_max={{ score_max }}&quiz={{ quiz_filter }}" aria-label="First">
                        <span aria-hidden="true">&laquo;&laquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}&sort_by={{ sort_by }}&user={{ user_filter }}&date_from={{ date_from }}&date_to={{ date_to }}&score_min={{ score_min }}&score_max={{ score_max }}&quiz={{ quiz_filter }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            </li>

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}&sort_by={{ sort_by }}&user={{ user_filter }}&date_from={{ date_from }}&date_to={{ date_to }}&score_min={{ score_min }}&score_max={{ score_max }}&quiz={{ quiz_filter }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}&sort_by={{ sort_by }}&user={{ user_filter }}&date_from={{ date_from }}&date_to={{ date_to }}&score_min={{ score_min }}&score_max={{ score_max }}&quiz={{ quiz_filter }}" aria-label="Last">
                        <span aria-hidden="true">&raquo;&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js"></script>
{% endblock %}


{% comment %} {% extends 'base.html' %}
{% load static %}

{% block title %}Quiz Results{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Quiz Results</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>User</th>
                <th>Quiz</th>
                <th>Avg. Percentage</th>
                <th>Avg. Score</th>
                <th>Date Taken</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for item in page_obj %}
            <tr>
                <td>{{ item.attempt.user.username }}</td>
                <td>{{ item.attempt.quiz.title }}</td>
                <td>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar" role="progressbar" 
                             style="width: {{ item.percentage_score }}%;" 
                             aria-valuenow="{{ item.percentage_score }}" 
                             aria-valuemin="0" aria-valuemax="100">
                            {{ item.percentage_score|floatformat:2 }}%
                        </div>
                    </div>
                </td>
                <td>{{ item.attempt.score }} / {{ item.total_questions }}</td>
                <td>{{ item.attempt.date_taken }}</td>
                <td><a href="{% url 'quiz_attempt_detail' item.attempt.id %}">View Details</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination controls -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1" aria-label="First">
                        <span aria-hidden="true">&laquo;&laquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            </li>

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="Last">
                        <span aria-hidden="true">&raquo;&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js"></script>
{% endblock %} {% endcomment %}


{% comment %} {% extends 'base.html' %}
{% load static %}

{% block title %}Quiz Results{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Quiz Results</h2>
    
    <!-- Sorting controls -->
    <div class="d-flex justify-content-end mb-3">
        <form method="get" class="form-inline">
            <label for="sort_by" class="mr-2">Sort by:</label>
            <select name="sort_by" id="sort_by" class="form-control" onchange="this.form.submit()">
                <option value="date_taken" {% if sort_by == 'date_taken' %}selected{% endif %}>Date Taken</option>
                <option value="percentage" {% if sort_by == 'percentage' %}selected{% endif %}>Percentage</option>
                <option value="score" {% if sort_by == 'score' %}selected{% endif %}>Score</option>
            </select>
        </form>
    </div>
    
    <table class="table table-striped">
        <thead>
            <tr>
                <th>User</th>
                <th>Quiz</th>
                <th>Avg. Percentage</th>
                <th>Avg. Score</th>
                <th>Date Taken</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for item in page_obj %}
            <tr>
                <td>{{ item.attempt.user.username }}</td>
                <td>{{ item.attempt.quiz.title }}</td>
                <td>
                    <span class="badge {{ item.badge_color }}">{{ item.percentage_score|floatformat:2 }}%</span>
                    <div class="progress mt-2" style="height: 20px;">
                        <div class="progress-bar {{ item.badge_color }}" role="progressbar" 
                             style="width: {{ item.percentage_score }}%;" 
                             aria-valuenow="{{ item.percentage_score }}" 
                             aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                </td>
                <td>{{ item.attempt.score }} / {{ item.total_questions }}</td>
                <td>{{ item.attempt.date_taken }}</td>
                <td><a href="{% url 'quiz_attempt_detail' item.attempt.id %}">View Details</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination controls -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1&sort_by={{ sort_by }}" aria-label="First">
                        <span aria-hidden="true">&laquo;&laquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}&sort_by={{ sort_by }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            </li>

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}&sort_by={{ sort_by }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}&sort_by={{ sort_by }}" aria-label="Last">
                        <span aria-hidden="true">&raquo;&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js"></script>
{% endblock %} {% endcomment %}
